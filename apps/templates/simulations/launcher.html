{% extends "layouts/base.html" %}

{% block title %} Simulations page {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

	<!-- [ Main Content ] start -->
	<div class="pcoded-main-container">
		<div class="pcoded-content">
			<!-- [ breadcrumb ] start -->
			<div class="page-header">
				<div class="page-block">
					<div class="row align-items-center">
						<div class="col-md-12">
							<div class="page-header-title">
								<h5 class="m-b-10">Simulations Page</h5>
							</div>
							<ul class="breadcrumb">
								<li class="breadcrumb-item"><a href="/"><i class="feather icon-home"></i></a></li>
								<li class="breadcrumb-item"><a href="#">Simulations</a></li>
								<li class="breadcrumb-item"><a href="#">Launcher</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<!-- [ breadcrumb ] end -->

			<!-- [ Main Content ] start -->
			<div class="row">

				<!-- [ Create a new simulation-page ] start -->
				<div class="col-md-12">
					<div class="card g-3 col-md-6">

						<div class="card-header">
							<h5>Create a new simulation</h5>
						</div>
						<div class="card-body">

                            <form method="post" action="" id="launch_form">

								{{ form.hidden_tag() }}

								<div class="input-group mb-4">
									<span class="input-group-text"><i class="feather icon-type"></i></span>
									{{ form.label(placeholder="Simulation Label", class="form-control") }}
								</div>

                                  <div class="input-group mb-4">
                                    <span class="input-group-text"><i class="feather icon-life-buoy"></i>&ensp;Number of virtual floats</span>
                                    <span class="form-control" id="nfloats_value"></span>
									{{ form.nb_floats(class="form-range", min="100", max="4000", step="10") }}
                                  </div>

								<button type="submit" name="launch" class="btn btn-block btn-primary mt-2 mb-4">Launch !</button>
								<button type="reset" name="reset" class="btn btn-block btn-danger mt-2 mb-4">Reset</button>

							</form>

						</div>
					</div>
				</div>
				<!-- [ Create a new simulation-page ] end -->

				<!-- [ List of user simulations-page ] start -->
				<div class="col-md-12">
					<div class="card table-card">
						<div class="card-header">
							<h5>Your simulations</h5>
						</div>
						<div class="card-body">
                            <div class="table-responsive">
                                <div class="customer-scroll" style="height:562px;position:relative;">
                                    <table class="table table-hover m-b-0" id="tasks_table">
                                        <thead>
                                            <tr>
                                                <th><span>Tasks</span></th>
                                                <th><span>User</span></th>
                                                <th><span>Status</span></th>
                                                <th><span>Number of floats</span></th>
                                                <th><span>Label</span></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- [ List of user simulations-page ] end -->

			</div>
			<!-- [ Main Content ] end -->
		</div>
	</div>
	<!-- [ Main Content ] end -->

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

    <script src="/static/assets/js/pages/simulations-launcher.js"></script>

    <script>
    var API =  {{ url_for("api_blueprint.tasks_task_list") | tojson }}

    $('button[name=reset]').on('click', function(){
      // Clean-up the form:
      $('input[name=label]').val("");
      $('input[name=nb_floats]').val();
      $('#nfloats_value').text($('input[name=nb_floats]').val());
      console.log("Form reset");
    } );

    list_tasks = function(api) {
        $.ajax({
          url:api,
          type:"GET",
          contentType:"application/json; charset=utf-8",
          dataType:"json",
          success: function(data){
            var html = '';
            for(var i = 0; i < data.length; i++){
            {#for(var i = data.length-1; i >= 0; i--){#}
                html += '<tr>'+
                            '<td>' + data[i].id + '</td>' +
                            '<td>' + data[i].username + '</td>' +
                            '<td>' + data[i].status + '</td>' +
                            '<td>' + data[i].nfloats + '</td>' +
                            '<td>' + data[i].label + '</td>' +
                        '</tr>';
                }
            $('#tasks_table tbody').html(html);
          }
        })
    };

    var RefreshTasksList = window.setInterval(function(){
        list_tasks(API);
        console.log('Refreshing tasks list...');
    }, 2000);

    $( document ).ready(function() {
        $('button[name=reset]').trigger('click');
        list_tasks(API);
    })


    </script>


{% endblock javascripts %}
